language: node_js
node_js:
  - 12
services:
  - postgresql
addons:
  postgresql: '10'
dist: xenial
notifications:
  email:
    on_success: change
    on_failure: always
install:
  - npm ci
before_script:
  - psql -c 'create database "gracebopper-test";' -U postgres
script:
  - npm test
  - npm run build-client
before_deploy:
  - rm -rf node_modules
deploy:
  skip_cleanup: true
  provider: heroku
  app: gracebopper
  api_key:
    secure: '10a8b351-c70b-4fb5-9da1-507ef2e5fd08'
